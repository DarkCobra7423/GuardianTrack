<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>List of missing persons</title>
  <style type="text/css">
    .person-list {
      list-style: none;
      padding: 0;
      margin: 0 auto;
      max-width: 450px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      overflow: hidden;
    }

    .person-item {
      display: flex;
      align-items: center;
      padding: 16px;
      border-bottom: 1px solid #eee;
      position: relative;
      cursor: pointer;
    }

    .avatar-wrapper {
      position: relative;
      margin-right: 16px;
      flex-shrink: 0;
    }

    .avatar {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #ccc;
    }

    /* Badge styling */
    .badge {
      position: absolute;
      top: -5px;
      right: -10px;
      padding: 2px 8px;
      font-size: 11px;
      font-weight: 700;
      border-radius: 12px;
      color: white;
      white-space: nowrap;
      box-shadow: 0 0 4px rgba(0,0,0,0.25);
      user-select: none;
    }

    .badge.red {
      background-color: #e74c3c;
    }

    .badge.green {
      background-color: #2ecc71;
    }

    .person-content {
      flex: 1;
    }

    .name {
      margin: 0;
      font-size: 17px;
      font-weight: 600;
      color: #333;
    }

    .location {
      margin: 4px 0 2px 0;
      font-size: 14px;
      color: #555;
    }

    .protocol {
      font-size: 13px;
      color: #888;
      font-style: italic;
      margin: 0;
    }

    .description {
      font-size: 13px;
      color: #666;
      margin: 6px 0 0 0;
    }

    .date {
      font-size: 12px;
      color: #aaa;
      margin-top: 4px;
    }

    .status-tag {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) rotate(-12deg);
      background-color: rgba(0, 0, 0, 0.65);
      color: #fff;
      font-size: 13px;
      font-weight: bold;
      padding: 4px 12px;
      border-radius: 10px;
      pointer-events: none;
      white-space: nowrap;
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
  </style>
</head>
<body>
  <ul id="peopleContainer" class="person-list">
    <!-- Aquí se llenará dinámicamente -->
  </ul>

<script>
  function showPeople(dataJson) {
    
    const container = document.getElementById("peopleContainer");
    container.innerHTML = "";

    dataJson.forEach(person => {

      // Crear el item (li)
      const item = document.createElement("li");
      item.className = "person-item";

      // Badge color y texto según status
      const badgeClass = person.status === "Missing" ? "red" : "green";
      const badgeText = person.status === "Missing" ? "Desaparecido" : "Encontrado";

      // Condición (status-tag)
      const isValidCondition = condition => 
  condition && typeof condition === "string" && condition.trim().toLowerCase() !== "unknown";

const conditionTag = isValidCondition(person.condition)
  ? `<span class="status-tag">${person.condition}</span>`
  : '';



      // Foto, si no hay, pongo un placeholder
      const imageUrl = person.photo_urls?.[0] || "https://via.placeholder.com/56";

      // Formatear fecha
      const missingSince = new Date(person.missing_date).toLocaleDateString();

      item.innerHTML = `
        <div class="avatar-wrapper">
          <img src="${imageUrl}" alt="Foto de ${person.full_name}" class="avatar" />
          <span class="badge ${badgeClass}">${badgeText}</span>
          ${conditionTag}
        </div>
        <div class="person-content">
          <p class="name">${person.full_name}</p>
          <p class="location">${person.city}, ${person.state} · ${person.age} años</p>
          <p class="protocol">${person.protocol}</p>          
          <p class="date"><strong>Desaparecido desde:</strong> ${missingSince}</p>
        </div>
      `;

      // Click redirecciona a bulletin.html (igual que lista estática)
      /*item.addEventListener('click', () => {
        window.location.href = 'bulletin.html';
      });*/

      // Al hacer clic, guardar datos y redirigir a bulletin.html
      item.addEventListener('click', () => {
  if (typeof localStorage !== 'undefined' && localStorage !== null) {
    localStorage.setItem('selectedPerson', JSON.stringify(person));
    window.location.href = 'bulletin.html';
  } else {
    alert('Error: localStorage no disponible. No se puede guardar el detalle.');
  }
});


      container.appendChild(item);
    });
  }

</script>
</body>
</html>